<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <script src="/theme.js"></script>
    <title>表情包管理 - Minechat</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <link rel="stylesheet" href="https://unpkg.com/element-plus/theme-chalk/dark/css-vars.css" />
    <style>
      [v-cloak]{display:none}
      html,body{height:100%;overflow:hidden;overscroll-behavior:none;-webkit-text-size-adjust:100%}
      body{margin:0;padding:0;background:#f5f5f5}
      input,textarea,.el-input__inner,.el-textarea__inner{font-size:16px !important}
      .top-spacer{position:fixed;top:0;left:0;right:0;height:4vh;background:var(--mc-body-bg);z-index:99}
      .top-bar{position:fixed;top:4vh;left:0;right:0;height:50px;background:#fff;border-bottom:1px solid #e6e6e6;display:flex;align-items:center;padding:0 12px;z-index:100;gap:8px}
      .content-area{position:fixed;top:calc(4vh + 50px);left:0;right:0;bottom:0;overflow:auto;padding:12px;-webkit-overflow-scrolling:touch;overscroll-behavior:contain}
      .emoji-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}
      .emoji-item{background:var(--mc-surface);border:1px solid var(--mc-border);border-radius:8px;padding:12px;text-align:center}
      .emoji-item img{width:100%;height:80px;object-fit:contain}
    </style>
  </head>
  <body>
    <div class="top-spacer"></div>
    <div id="app" v-cloak>
      <div class="top-bar">
        <el-button @click="goBack" circle size="small">
          <el-icon><arrow-left /></el-icon>
        </el-button>
        <h3 style="margin:0;flex:1">表情包管理</h3>
      </div>

      <div class="content-area">
        <el-card style="margin-bottom:12px">
          <div style="margin-bottom:8px">
            <el-input v-model="name" placeholder="名称（可选）" size="small"></el-input>
          </div>
          <div style="display:flex;gap:8px">
            <input ref="fileInput" type="file" accept="image/*" @change="onFileChange" style="display:none" />
            <el-button @click="selectFile" size="small" style="flex:1">选择图片</el-button>
            <el-button type="primary" :disabled="!selectedFile" @click="upload" size="small" style="flex:1">上传</el-button>
          </div>
          <div v-if="selectedFile" style="margin-top:8px;font-size:12px;color:#666">
            已选择: {{ selectedFile.name }}
          </div>
        </el-card>

        <div class="emoji-grid">
          <div v-for="p in packs" :key="p.id" class="emoji-item">
            <img :src="p.url" />
            <div style="margin-top:8px;font-size:13px;font-weight:500">{{ p.name || p.id }}</div>
            <el-button type="danger" size="small" @click="del(p.id)" style="margin-top:6px;width:100%">删除</el-button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue@2/dist/index.iife.min.js"></script>
    <script src="/m/emojis.js"></script>
    <script>
      document.addEventListener('gesturestart', function (e) { e.preventDefault(); }, { passive: false });
      document.addEventListener('gesturechange', function (e) { e.preventDefault(); }, { passive: false });
      document.addEventListener('gestureend', function (e) { e.preventDefault(); }, { passive: false });

      (function () {
        var meta = document.querySelector('meta[name="viewport"]');
        if (!meta) return;
        var canonical = 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover';
        function restoreViewport() {
          try {
            meta.setAttribute('content', canonical);
          } catch (e) {}
        }
        function onPossibleZoomChange() {
          restoreViewport();
          setTimeout(restoreViewport, 50);
          setTimeout(restoreViewport, 250);
        }
        document.addEventListener('focusin', function (e) {
          var t = e && e.target;
          if (!t) return;
          var tag = (t.tagName || '').toUpperCase();
          if (tag === 'INPUT' || tag === 'TEXTAREA') onPossibleZoomChange();
        }, true);
        document.addEventListener('focusout', function () { onPossibleZoomChange(); }, true);
        window.addEventListener('resize', onPossibleZoomChange);
        window.addEventListener('orientationchange', onPossibleZoomChange);
        if (window.visualViewport) {
          window.visualViewport.addEventListener('resize', onPossibleZoomChange);
        }
      })();
    </script>
  </body>
</html>
