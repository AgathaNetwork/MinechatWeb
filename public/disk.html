<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="/theme.js"></script>
    <title>网盘 - Minechat</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="/vendor/element-plus/index.css" />
    <link rel="stylesheet" href="/vendor/element-plus/theme-chalk/dark/css-vars.css" />
    <style>
      [v-cloak]{display:none}
      .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
      .wrap{word-break:break-all;overflow-wrap:anywhere}
    </style>
  </head>
  <body>
    <div id="app" v-cloak>
      <el-container style="height:100vh">
        <el-header style="display:flex;align-items:center;justify-content:space-between">
          <div style="display:flex;align-items:center;gap:16px">
            <h2 style="margin:0">网盘</h2>
            <el-menu mode="horizontal" :ellipsis="false" default-active="disk" @select="onNav" style="border-bottom:none;background:transparent">
              <el-menu-item index="chat">会话</el-menu-item>
              <el-menu-item index="players">玩家</el-menu-item>
              <el-menu-item index="gallery">相册</el-menu-item>
              <el-menu-item index="me">工作台</el-menu-item>
            </el-menu>
          </div>
          <div></div>
        </el-header>

        <el-main style="padding:12px">
          <el-card>
            <el-alert
              type="info"
              :closable="false"
              show-icon
              title="说明"
              description="不支持文件夹；文件上传后对所有人可见，请勿发布违法违规内容。"
            ></el-alert>

            <div style="margin-top:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
              <el-input v-model="uploadName" placeholder="文件名（可选，默认原文件名）" style="width:260px" clearable></el-input>
              <input ref="uploadInput" type="file" style="max-width:260px" />
              <el-button type="primary" :loading="uploading" :disabled="uploading" @click="upload">上传</el-button>
              <el-button plain :loading="loading" :disabled="loading" @click="refresh">刷新</el-button>
              <span style="font-size:12px;color:#888" v-if="files && files.length">共 {{ files.length }} 个</span>
            </div>

            <div style="margin-top:12px" v-if="lastError">
              <el-alert type="error" :closable="false" show-icon title="操作失败"></el-alert>
              <div style="margin-top:8px;font-size:12px;color:#666" class="wrap">{{ lastError }}</div>
            </div>

            <el-table :data="files" border size="small" style="width:100%;margin-top:12px" v-loading="loading">
              <el-table-column prop="name" label="名称" min-width="220"></el-table-column>
              <el-table-column prop="sizeText" label="大小" width="120"></el-table-column>
              <el-table-column label="操作" width="260" fixed="right">
                <template #default="scope">
                  <el-button size="small" plain @click="downloadFile(scope.row)">下载</el-button>
                  <el-button size="small" plain @click="renameFile(scope.row)">重命名</el-button>
                  <!-- <el-button size="small" plain @click="replaceFile(scope.row)">替换</el-button> -->
                  <el-button size="small" type="danger" plain @click="deleteFile(scope.row)">删除</el-button>
                </template>
              </el-table-column>
            </el-table>

            <input ref="replaceInput" type="file" style="display:none" @change="onReplacePicked" />
          </el-card>
        </el-main>
      </el-container>
    </div>

    <script src="/vendor/vue/vue.global.prod.js"></script>
    <script src="/vendor/element-plus/index.full.js"></script>
    <script src="/vendor/element-plus-icons/icons-vue.iife.min.js"></script>
    <script src="/disk.js"></script>
  </body>
</html>
